<%# Search form - minimal style %>
<div class="navbar-search">
  <%= form_with url: root_path, method: :get, local: true, class: "search-form" do |form| %>
    <%= form.text_field :q, 
        value: params[:q],
        placeholder: "搜索...", 
        class: "search-input" %>
  <% end %>
</div>

<ul>
    <li>
      <%= link_to "Home", root_path, class: "nav-link#{' current' if current_page?(root_path)}" %>
    </li>
    <li>
      <%= link_to "Tags", tags_path, class: "nav-link#{' current' if current_page?(tags_path)}" %>
    </li>
  <% if navbar_items.present? %>
    <% navbar_items.each do |page| %>
      <li>
        <%= link_to page.title, page_link_path(page), page_link_attributes(page).merge(class: "nav-link#{' current' if current_page?(page_link_path(page))}") %>
      </li>
    <% end %>     
  <% end %>
</ul>

<%# Newsletter subscription form - only show on index page when newsletter is enabled and using native mail %>
<% if current_page?(root_path) %>
  <% newsletter_setting = CacheableSettings.newsletter_setting %>
  <% if newsletter_setting[:enabled] && newsletter_setting[:native] %>
    <div class="newsletter-subscription" data-controller="newsletter-subscription math-captcha" data-action="submit->newsletter-subscription#submit" data-math-captcha-max-value="10">
      <%= form_with url: subscriptions_path, method: :post, data: { newsletter_subscription_target: "form", turbo: false, action: "submit->math-captcha#ensureValid" } do |form| %>
        <% captcha = math_captcha_challenge(max: 10) %>
        <% captcha_answer_id = "navbar-subscription-captcha-answer-#{SecureRandom.hex(6)}" %>
        <div class="newsletter-form-group">
          <%= form.email_field :email, 
              name: "subscription[email]",
              placeholder: "通过邮件订阅更新", 
              required: true,
              class: "newsletter-email-input",
              data: { newsletter_subscription_target: "emailInput", action: "focus->math-captcha#show" } %>
          <%= form.submit "订阅", 
              class: "newsletter-submit-btn",
              data: { newsletter_subscription_target: "submitBtn" } %>
        </div>
        <div data-math-captcha-target="container" style="margin-top: 0.5rem;">
          <label for="<%= captcha_answer_id %>" style="font-size: 12px; color: #666;"><span data-math-captcha-target="question"><%= captcha[:question] %></span></label>
          <%= text_field_tag "captcha[answer]", nil, id: captcha_answer_id, required: true, inputmode: "numeric", autocomplete: "off", placeholder: "答案", style: "margin-left: 0.5rem; width: 90px; padding: 0.4rem; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;", data: { math_captcha_target: "answer", action: "input->math-captcha#validate blur->math-captcha#validate" } %>
          <div data-math-captcha-target="message" style="margin-top: 0.25rem; font-size: 12px; display: none;"></div>
          <%= hidden_field_tag "captcha[a]", captcha[:a], data: { math_captcha_target: "a" } %>
          <%= hidden_field_tag "captcha[b]", captcha[:b], data: { math_captcha_target: "b" } %>
          <%= hidden_field_tag "captcha[op]", captcha[:op], data: { math_captcha_target: "op" } %>
        </div>
        <div class="newsletter-message" data-newsletter-subscription-target="message"></div>
      <% end %>
    </div>
  <% end %>
<% end %>
