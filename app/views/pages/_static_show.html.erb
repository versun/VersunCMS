<% content_for :title do %>
  <%= @page.title %> | <%= site_settings[:title] %>
<% end %>
<article>
  <div class="article-content">
    <% if @page.html? %>
      <%= safe_html_content(@page.html_content) %>
    <% else %>
      <%= @page.content %>
    <% end %>
  </div>
</article>

<% if @page.comment? %>
  <hr>
  <div id="comments-section">
    <% local_comments = @page.comments.local.approved.top_level %>

    <% if local_comments.any? %>
      <div style="margin-top: 2rem; margin-bottom: 1.5rem;">
        <% total_count = @page.comments.local.approved.count %>
        <h3 style="margin-bottom: 1rem; color: #333; font-size: 1.125rem;">Comments (<%= total_count %>)</h3>
      </div>
      
      <% local_comments.each do |comment| %>
        <%= render 'comments/static_comment', comment_item: { type: 'local', data: comment } %>
      <% end %>
    <% end %>

    <%= render 'comments/static_form', comment: Comment.new %>
  </div>

  <script>
    function showReplyForm(commentId) {
      var formContainer = document.getElementById('reply-form-' + commentId);
      if (formContainer) {
        formContainer.style.display = 'block';
        formContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        var textarea = formContainer.querySelector('textarea');
        if (textarea) {
          setTimeout(function() { textarea.focus(); }, 100);
        }
      }
    }

    function hideReplyForm(commentId) {
      var formContainer = document.getElementById('reply-form-' + commentId);
      if (formContainer) {
        formContainer.style.display = 'none';
        var form = formContainer.querySelector('form');
        if (form) {
          form.reset();
        }
      }
    }
  </script>
<% end %>

<hr>
<div class="giscus"></div>
<%= raw site_settings[:giscus] %>

