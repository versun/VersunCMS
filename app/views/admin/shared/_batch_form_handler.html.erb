<% # Shared batch form submission handler %>
<script>
function submitBatchForm(button, action) {
  const form = button.closest('form');
  const controller = document.querySelector('[data-controller="batch-selection"]');
  const checkboxes = controller.querySelectorAll('input[type="checkbox"][data-batch-selection-target="checkbox"]:checked');
  
  if (checkboxes.length === 0) {
    alert('Please select at least one item.');
    return false;
  }

  // Clear existing hidden inputs
  form.querySelectorAll('input[name="ids[]"]').forEach(input => input.remove());
  
  // Add selected IDs as hidden inputs
  checkboxes.forEach(checkbox => {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'ids[]';
    input.value = checkbox.value;
    form.appendChild(input);
  });

  if (action === 'delete' && !confirm(`Are you sure you want to delete ${checkboxes.length} item(s)?`)) {
    return false;
  }

  return true;
}
</script>
