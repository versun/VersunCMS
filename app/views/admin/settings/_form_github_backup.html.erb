<h3>GitHub Backup Settings</h3>

<div class="field checkbox">
  <%= form.check_box :github_backup_enabled %>
  <%= form.label :github_backup_enabled, "Enable GitHub Backup" %>
</div>

<div class="field">
  <%= form.label :github_repo_url, "GitHub Repository URL" %>
  <%= form.text_field :github_repo_url, placeholder: "https://github.com/username/backup-repo.git" %>
  <small>The GitHub repository URL where backups will be stored</small>
</div>

<div class="field" data-controller="password-toggle">
  <%= form.label :github_token, "GitHub Personal Access Token" %>
  <div style="position: relative; display: flex; align-items: center;">
    <%= form.password_field :github_token, 
        data: { password_toggle_target: "input" },
        placeholder: "ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
        style: "flex: 1; padding-right: 4rem;" %>
    <button type="button" 
            data-password-toggle-target="toggleButton"
            data-action="click->password-toggle#toggle"
            style="position: absolute; right: 0.5rem; padding: 0.25rem 0.5rem; font-size: 12px; border: 1px solid var(--border, #ddd); border-radius: 4px; background: var(--bg, #fff); cursor: pointer; color: var(--text, #333);">
      Show
    </button>
  </div>
  <small>
    Create a token at 
    <%= link_to "GitHub Settings", "https://github.com/settings/tokens/new", target: "_blank" %>
    with <code>repo</code> scope
  </small>
</div>

<div class="field">
  <%= form.label :github_backup_branch, "Branch Name" %>
  <%= form.text_field :github_backup_branch, placeholder: "main" %>
  <small>Default: main</small>
</div>

<div class="field">
  <%= form.label :git_user_name, "Git User Name" %>
  <%= form.text_field :git_user_name, placeholder: "VersunCMS" %>
  <small>Name for git commits (default: VersunCMS)</small>
</div>

<div class="field">
  <%= form.label :git_user_email, "Git User Email" %>
  <%= form.email_field :git_user_email, placeholder: "backup@versuncms.local" %>
  <small>Email for git commits (default: backup@versuncms.local)</small>
</div>

<div class="field">
  <%= form.label :github_backup_schedule, "Backup Schedule" %>
  <%= form.select :github_backup_schedule, 
      options_for_select([
        ['Disabled', ''],
        ['Daily at 12:00 AM', 'daily'],
        ['Weekly on Monday at 12:00 AM', 'weekly'],
        ['Monthly on 1st at 12:00 AM', 'monthly']
      ], @setting.github_backup_schedule),
      {},
      { class: "form-select" } %>
  <small>
    Select the frequency for automatic backups. All backups run at 12:00 AM (midnight).
  </small>
</div>

<% if @setting.last_backup_at.present? %>
  <div class="field">
    <strong>Last Backup:</strong> 
    <%= @setting.last_backup_at.in_time_zone(@setting.time_zone || 'UTC').strftime('%Y-%m-%d %H:%M:%S %Z') %>
  </div>
<% end %>

<div class="info-text">
  <strong>Setup Instructions:</strong>
  <ol>
    <li>Create a new GitHub repository for backups, or use an existing one. Make sure it is not empty.</li>
    <li>Generate a Personal Access Token with <code>repo</code> scope</li>
    <li>Fill in the repository URL and token above</li>
    <li>Configure git user settings for commits</li>
    <li>Optionally set up a cron schedule for automatic backups</li>
    <li>Save settings and trigger a manual backup from the Migrate page</li>
  </ol>
</div>
