<%= form_with(model: [:admin, page]) do |form| %>
  <% if page.errors.any? %>
    <div class="form-errors">
      <strong><%= pluralize(page.errors.count, "error") %> prohibited this page from being saved:</strong>
      <ul>
        <% page.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-section compact">
    <h3>Basic Information</h3>

    <div class="form-grid form-grid-2">
      <div class="field">
        <%= form.label :title %>
        <%= form.text_field :title, required: true %>
      </div>

      <div class="field">
        <%= form.label :slug %>
        <%= form.text_field :slug, required: true %>
      </div>
    </div>

    <div class="form-grid form-grid-2">
      <div class="field">
        <%= form.label :page_order, "Page Order" %>
        <%= form.number_field :page_order, required: true %>
      </div>

      <div class="field">
        <%= form.label :redirect_url, "Redirect To (Optional)" %>
        <%= form.url_field :redirect_url, placeholder: "https://example.com" %>
      </div>
    </div>
    
    <small>Leave redirect URL empty to use page content</small>
  </div>

  <div class="form-section compact">
    <h3>Content</h3>
    <div class="field">
      <%= form.rich_text_area :content, required: true %>
    </div>
  </div>

  <div class="form-section compact">
    <h3>Publishing</h3>

    <div class="field">
      <%= form.label :status %>
      <%= form.select :status, Page.statuses.keys, 
          { prompt: 'Choose a status' }, 
          { id: 'status_select', required: true } %>
    </div>

    <div class="field" id="scheduled_at" style="display: <%= form.object.schedule? ? 'block' : 'none' %>">
      <%= form.label :scheduled_at, "Schedule For" %>
      <%= form.datetime_field :scheduled_at %>
      <small>Current: <%= Time.current.strftime("%Y/%m/%d %I:%M %p %Z") %></small>
    </div>
  </div>

  <div class="form-actions">
    <%= form.submit "Save" %>
    <% if page.persisted? %>
      <%= link_to "Delete", admin_page_path(page), 
          class: "btn btn-danger",
          data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>
    <% end %>
  </div>
<% end %>

<%= javascript_tag do %>
  function initializeScheduledAt() {
    const statusSelect = document.getElementById('status_select');
    const scheduledAtContainer = document.getElementById('scheduled_at');
    
    if (statusSelect && scheduledAtContainer) {
      statusSelect.addEventListener('change', function() {
        scheduledAtContainer.style.display = this.value === 'schedule' ? 'block' : 'none';
      });
    }
  }
  
  document.addEventListener("DOMContentLoaded", initializeScheduledAt);
  document.addEventListener("turbo:load", initializeScheduledAt);
<% end %>