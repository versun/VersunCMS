<% content_for :title do %>
  <%= @article.title %> | <%= site_settings[:title] %>
<% end %>

<style>
  .article-content img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 1rem 0;
  }
  
  .social-icon-link {
    display: inline-block;
    vertical-align: middle;
    margin-right: 0.25rem;
  }
  
  .social-icon {
    display: inline-block;
    vertical-align: middle;
  }
</style>
<article>
  <h2><%= @article.title %></h2>
  <small style="color:grey">
  <span>Published on <%= @article.created_at.to_date %></span>
  <% if @article.social_media_posts.any? %>
      <span class="social-label">, Also posted to:</span>
      <% @article.social_media_posts.each do |post| %>
        <% if post.url.present? %>
          <a href="<%= post.url %>" target="_blank" rel="noopener noreferrer" class="social-icon-link">
            <%= image_tag "/#{post.icon_path}", size: "16", alt: post.platform.titleize, class: "social-icon", title: post.platform.titleize %>
          </a>
        <% end %>
      <% end %>
  <% end %>
  </small>
  <div class="article-content">
    <%= @article.content %>
  </div>
</article>
<hr>
<div style="margin-top: 2rem;">

</div>
<% if @article.comments.mastodon.any? %>
  <div class="mastodon-comments">
    <% @article.comments.mastodon.each do |comment| %>
      <div class="comment" style="margin-bottom: 1.5rem; padding: 1rem; border-left: 3px solid #6364FF;">
        <div style="display: flex; align-items: start; gap: 0.75rem;">
          <% if comment.author_avatar_url.present? %>
            <img src="<%= comment.author_avatar_url %>" alt="<%= comment.author_name %>" style="width: 40px; height: 40px; border-radius: 50%;">
          <% else %>
            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #6364FF; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
              <%= comment.author_name.to_s.first.upcase %>
            </div>
          <% end %>
          <div style="flex: 1;">
            <div style="margin-bottom: 0.5rem;">
              <strong><%= comment.author_name %></strong> 
              <span style="color: #666;">@<%= comment.author_username %></span>
              <small style="color: #999; margin-left: 0.5rem;"><%= time_ago_in_words(comment.published_at) %> ago on <%= link_to "Mastodon", comment.url, target: "_blank", style: "font-size: 0.9rem; color: #6364FF;" %></small>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <%= sanitize comment.content, tags: %w[p br a span], attributes: %w[href class rel target] %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<% if @article.comments.bluesky.any? %>
  <div class="bluesky-comments">
    <% @article.comments.bluesky.each do |comment| %>
      <div class="comment" style="margin-bottom: 1.5rem; padding: 1rem; border-left: 3px solid #0085FF;">
        <div style="display: flex; align-items: start; gap: 0.75rem;">
          <% if comment.author_avatar_url.present? %>
            <img src="<%= comment.author_avatar_url %>" alt="<%= comment.author_name %>" style="width: 40px; height: 40px; border-radius: 50%;">
          <% else %>
            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #0085FF; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
              <%= comment.author_name.to_s.first.upcase %>
            </div>
          <% end %>
          <div style="flex: 1;">
            <div style="margin-bottom: 0.5rem;">
              <strong><%= comment.author_name %></strong> 
              <span style="color: #666;">@<%= comment.author_username %></span>
              <small style="color: #999; margin-left: 0.5rem;"><%= time_ago_in_words(comment.published_at) %> ago on <%= link_to "Bluesky", comment.url, target: "_blank", style: "font-size: 0.9rem; color: #0085FF;" %></small>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <%= sanitize comment.content, tags: %w[p br a span], attributes: %w[href class rel target] %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

<div class="giscus"></div>
<%= raw site_settings[:giscus] %>
<% end %>
