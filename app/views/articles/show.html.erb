<% content_for :title do %>
  <%= @article.title %> | <%= site_settings[:title] %>
<% end %>

<article>
  <h2><%= @article.title %></h2>
  <small style="color:grey">
  <span>Published on <%= @article.created_at.to_date %></span>
  <% if @article.social_media_posts.any? %>
      <span class="social-label">, Also posted to:</span>
      <% @article.social_media_posts.each do |post| %>
        <% if post.url.present? %>
          <% 
            # ä»Ž settings ä¸­èŽ·å–å¯¹åº”å¹³å°çš„å›¾æ ‡ä¿¡æ¯
            platform_config = site_settings[:social_links]&.dig(post.platform)
            icon_class = platform_config&.dig('icon')
            display_name = platform_config&.dig('name') || post.platform.titleize
          %>
          <a href="<%= post.url %>" target="_blank" rel="noopener noreferrer" class="social-icon-link" title="<%= display_name %>">
            <% if icon_class.present? %>
              <i class="<%= icon_class %>" style="font-size: 16px;"></i>
            <% else %>
              <span style="font-size: 14px;">ðŸ”—</span>
            <% end %>
          </a>
        <% end %>
      <% end %>
  <% end %>
  </small>
  <div class="article-content">
    <%= @article.content %>
  </div>
  
  <% if @article.tags.any? %>
    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #eee;">
      <small style="color: #666;">Tagged with: </small>
      <% @article.tags.each do |tag| %>
        <%= link_to tag_path(tag.slug), style: "text-decoration: none;" do %>
          <span style="display: inline-block; margin: 0.25rem 0.5rem 0.25rem 0; padding: 0.25rem 0.75rem; background-color: #f0f0f0; color: #333; border-radius: 4px; font-size: 0.9rem; cursor: pointer; transition: background-color 0.2s;">
            <%= tag.name %>
          </span>
        <% end %>
      <% end %>
    </div>
  <% end %>
</article>
<hr>
<div style="margin-top: 2rem;">

</div>
<% if @article.comments.mastodon.any? %>
  <div class="mastodon-comments">
    <% @article.comments.mastodon.each do |comment| %>
      <div class="comment" style="margin-bottom: 1.5rem; padding: 1rem; border-left: 3px solid #6364FF;">
        <div style="display: flex; align-items: start; gap: 0.75rem;">
          <% if comment.author_avatar_url.present? %>
            <img src="<%= comment.author_avatar_url %>" alt="<%= comment.author_name %>" style="width: 40px; height: 40px; border-radius: 50%;">
          <% else %>
            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #6364FF; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
              <%= comment.author_name.to_s.first.upcase %>
            </div>
          <% end %>
          <div style="flex: 1;">
            <div style="margin-bottom: 0.5rem;">
              <strong><%= comment.author_name %></strong> 
              <span style="color: #666;">@<%= comment.author_username %></span>
              <small style="color: #999; margin-left: 0.5rem;"><%= time_ago_in_words(comment.published_at) %> ago on <%= link_to "Mastodon", comment.url, target: "_blank", style: "font-size: 0.9rem; color: #6364FF;" %></small>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <%= sanitize comment.content, tags: %w[p br a span], attributes: %w[href class rel target] %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<% if @article.comments.bluesky.any? %>
  <div class="bluesky-comments">
    <% @article.comments.bluesky.each do |comment| %>
      <div class="comment" style="margin-bottom: 1.5rem; padding: 1rem; border-left: 3px solid #0085FF;">
        <div style="display: flex; align-items: start; gap: 0.75rem;">
          <% if comment.author_avatar_url.present? %>
            <img src="<%= comment.author_avatar_url %>" alt="<%= comment.author_name %>" style="width: 40px; height: 40px; border-radius: 50%;">
          <% else %>
            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #0085FF; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
              <%= comment.author_name.to_s.first.upcase %>
            </div>
          <% end %>
          <div style="flex: 1;">
            <div style="margin-bottom: 0.5rem;">
              <strong><%= comment.author_name %></strong> 
              <span style="color: #666;">@<%= comment.author_username %></span>
              <small style="color: #999; margin-left: 0.5rem;"><%= time_ago_in_words(comment.published_at) %> ago on <%= link_to "Bluesky", comment.url, target: "_blank", style: "font-size: 0.9rem; color: #0085FF;" %></small>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <%= sanitize comment.content, tags: %w[p br a span], attributes: %w[href class rel target] %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

<div class="giscus"></div>
<%= raw site_settings[:giscus] %>
<% end %>
